{{- define "main" -}}

{{- if not hugo.IsProduction -}}
  {{- partial "debug.html" . -}}
{{- end -}}

{{- partial "hero.html" . -}}

{{/* get the latest news articles by category except the ones with "hero" parameters in front matter */}}
{{- $pages := slice -}}
{{- with .Site.Sites.Default -}}
  {{- range .Taxonomies.categories.ByCount -}}
    {{- range first 1 (where .Pages "Params.hero" "ne" true) -}}
      {{- $pages = $pages | append . -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
{{- $pages = first (.Params.paginate | default 6) $pages -}}

<section class="articles">
  {{- range $index, $page := $pages -}}
    <article>
      {{- partial "category.html" . -}}
      <a href="{{ .Permalink }}"
        alt="ARTICLE"
        aria-label="{{ .Title | plainify }}"
        title="{{ .Title | plainify }}">
        {{- with .Store -}}
          {{- .Set "articles" true -}}
        {{- end -}}
        {{- partial "cover.html" . -}}
        {{- with .Store -}}
          {{- .Delete "articles" -}}
        {{- end -}}
        {{- if not .Date.IsZero -}}
          <span class="entry-date">
            <time datetime="{{ .Date }}">
              {{ .Date | time.Format ":date_long" }}
            </time>
          </span>
        {{- end -}}
        <h3 class="entry-title">
          <span>
            {{ .Title | .RenderString }}
          </span>
          {{- if .Draft }}
            <sup>
              <span class="entry-isdraft">
                [{{- i18n "draft" | default "Draft" -}}]
              </span>
            </sup>
          {{- end -}}
        </h3>
        {{- if (ne (.Param "hideSummary") true) -}}
        <p class="entry-description">
          {{- if .Description -}}
            {{ .Description | .RenderString }}
          {{- end -}}
        </p>
        {{- end -}}
      </a>
    </article>
  {{- end -}}
</section>

{{- with (index (where (.RegularPages | lang.Merge .Sites.Default.RegularPages) "Type" "homepage") 0) -}}
  {{- partial "content.html" . -}}
{{- end -}}

{{- end -}}
{{- /* end main */ -}}
