{{- define "main" -}}

{{- if not hugo.IsProduction -}}
  {{- partial "debug.html" . -}}
{{- end -}}

<header>
  {{- if eq .Type "news" -}}
    {{- partial "category.html" . -}}
  {{- end -}}

  {{- if eq .Section "releases" -}}
    {{- with .Site.GetPage "releases" -}}
      <span class="releases">
        <a href="{{ .RelPermalink }}">
          {{ .LinkTitle | .RenderString }}
        </a>
      </span>
    {{- end -}}
  {{- end -}}

  <h1 class="title">
    {{ .Title | .RenderString }}
    {{- if .Draft -}}
      <sup><span class="entry-isdraft">[{{- i18n "draft" | default "Draft" -}}]</span></sup>
    {{- end -}}
  </h1>

  {{- if .Description -}}
    <h3 class="description">
      {{ .Description | .RenderString }}
    </h3>
  {{- end -}}

  {{/* For Download pages, call the release partial to provide download links from the latest release. */}}
  {{- if eq .Type "download" -}}
    {{- $latest_release := index (where site.RegularPages "Type" "releases") 0 | default (index (where site.Sites.Default.RegularPages "Type" "releases") 0) -}}
    {{- with $latest_release -}}
      {{- partial "release.html" . -}}
      {{- if .Title -}}
        <a class="release-button" href="{{ .RelPermalink }}" alt="{{ upper .Title -}} RELEASE"
          aria-label="{{ .Title }} {{ i18n "release_notes" | default "Release Notes" }}">
          {{ printf "%s %s Â· " .Title (i18n "release_notes" | default "Release Notes") }}
          {{- with .Date -}}
            <time datetime="{{ . }}" class="date">
              {{ . | time.Format ":date_long" }}
            </time>
          {{- else -}}
            {{- print "Release Date is falsy" -}}
          {{- end -}}
        </a>
      {{- else -}}
        {{- print "Release Title is falsy" -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}

  {{- with .Params.cards -}}
    {{- partial "hero_cards.html" . -}}
  {{- end -}}

  {{- if or (eq .Type "news") (eq .Type "releases") -}}
    <div class="single-meta">
      {{- partial "meta.html" . -}}
    </div>
  {{- end -}}
  {{- partial "hero_cover.html" . -}}
</header>

{{/* Get the Table Of Contents. */}}
{{- if .Params.ToC -}}
  {{ .TableOfContents }}
{{- end -}}

{{/* Get the content of a Page. */}}
{{- partial "content.html" . -}}

{{/* Provide download links from the current release page. */}}
{{- if eq .Type "releases" -}}
  <section class="download-release">
    <h3>{{ printf "%s %s" (i18n "download" | default "Download") .Title }}</h3>
    {{- partial "release.html" . -}}
  </section>
{{- end -}}

{{/* For Telemetry page, call the telemetry partial to transform and parse serialized data. */}}
{{- if eq .Type "telemetry" -}}
  <section class="telemetry">
    {{- partial "telemetry.html" . -}}
  </section>
{{- end -}}

<footer class="single-footer">
  {{- if .Params.tags -}}
    <ul class="terms">
      {{- $taxonomy := site.Taxonomies.tags -}}
      {{- range .GetTerms "tags" -}}
        {{- $count := len ($taxonomy.Get .Title) -}}
        <li>
          <a href="{{ .RelPermalink }}">
            {{ .LinkTitle }}
            <sup>
              {{ $count }}
            </sup>
          </a>
        </li>
      {{- end -}}
    </ul>
  {{- end -}}
  {{- if (.Param "showPaginationLinks") -}}
    {{- partial "pagination_links.html" . -}}
  {{- end -}}
</footer>

{{- end -}}
{{/* end main */}}