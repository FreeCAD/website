
{{/* theme toggle */}}
{{- if not site.Params.disableThemeToggle }}
  <script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
      if (document.body.className.includes("dark")) {
        document.body.classList.remove('dark');
        localStorage.setItem("pref-theme", 'light');
      } else {
        document.body.classList.add('dark');
        localStorage.setItem("pref-theme", 'dark');
      }
    })
  </script>
{{- end }}

{{- /* Script to detect User Agent and provide corresponding download options. */}}
{{- if or (eq .Type "download") (eq .Type "releases") -}}
  {{- if site.Params.enableUA -}}
    {{- $downloadUA := resources.Get "js/DownloadUACheck.js" -}}
    {{- if hugo.IsProduction -}}
      {{- $downloadUA = minify $downloadUA -}}
    {{- end -}}
    <script type="text/javascript" src="{{ $downloadUA.RelPermalink }}">
    </script>
  {{- end -}}
{{- end -}}

{{- if .IsPage -}}

  {{- /* Copy Code script */}}
  {{- if (and (eq .Kind "page") (ne .Layout "archives") site.Params.showCopyCodeButton) -}}
    <script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
      const container = codeblock.parentNode.parentNode;

      const copybutton = document.createElement('button');
      copybutton.classList.add('copy-code');
      copybutton.innerText = '{{- i18n "code_copy" | default "copy" -}}';

      function copyingDone() {
        copybutton.innerText = '{{- i18n "code_copied" | default "copied!" -}}';
        setTimeout(() => {
          copybutton.innerText = '{{- i18n "code_copy" | default "copy" -}}';
        }, 2000);
      }

      copybutton.addEventListener('click', (cb) => {
        if ('clipboard' in navigator) {
          navigator.clipboard.writeText(codeblock.textContent);
          copyingDone();
          return;
        }

        const range = document.createRange();
        range.selectNodeContents(codeblock);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        try {
          document.execCommand('copy');
          copyingDone();
        } catch (e) { };
        selection.removeRange(range);
      });

      if (container.classList.contains("highlight")) {
        container.appendChild(copybutton);
      } else if (container.parentNode.firstChild == container) {
        // td containing LineNos
      } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
        // table containing LineNos and code
        codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
      } else {
        // code blocks not having highlight as parent class
        codeblock.parentNode.appendChild(copybutton);
      }
    });
    </script>
  {{- end -}}

{{- end -}}

{{- /* InstantClick.js */}}

{{- if site.Params.enableInstantClick -}}
  {{- $instantClick := resources.Get "js/InstantClick.js" -}}
  {{- if hugo.IsProduction -}}
    {{- $instantClick = minify $instantClick -}}
  {{- end -}}
  <script defer type="text/javascript" src="{{ $instantClick.RelPermalink }}" data-no-instant
    {{- if site.Params.assets.disableFingerprinting -}}
      integrity="{{ $instantClick.Data.Integrity }}"
    {{- end -}}>
  </script>

  <script data-no-instant>
    InstantClick.init();
  </script>
{{- end -}}