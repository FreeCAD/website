{{- define "main" -}}

{{/* Debug only in non-production environments */}}
{{- if not hugo.IsProduction -}}
  {{- partial "debug.html" . -}}
{{- end -}}

<section class="archives">

  <header>
    <h1>
      {{ .Title | .RenderString }}
    </h1>
    {{- with .Description -}}
      <p class="archives-description">
        {{ . | .RenderString }}
      </p>
    {{- end -}}
  </header>

  {{/* Set sections to include in archive (as defined by mainSection config or in current section) */}}
  {{- $sections := site.Params.mainSections | default (slice "news") -}}
  {{- with .Section -}}
    {{- $sections = slice . -}}
  {{- end -}}
  {{- $pages := where site.RegularPages "Section" "in" $sections -}}

  {{/* Group pages by year and then by month */}}
  {{- range $year := $pages.GroupByPublishDate "2006" -}}
    {{- if ne $year .Key "0001" -}}
      <div class="archive-year">
        <h2 class="archive-year-header">
          {{ $year.Key }}
          <sup class="archive-count">
            {{- len $year.Pages -}}
          </sup>
        </h2>

        {{- range $month := $year.Pages.GroupByDate "January" -}}
        <div class="archive-month">
          <h3 class="archive-month-header">
            {{ $month.Key }}
            <sup class="archive-count">
              {{- len $month.Pages -}}
            </sup>
          </h3>

          <div class="archive-month-list">
            {{- range $month.Pages -}}
            <article class="archive-entry">
              <a href="{{ .Permalink }}"
                alt="ARTICLE"
                aria-label="{{ .Title | plainify }}"
                title="{{ .Title | plainify }}">
                <h3 class="archive-entry-title">
                {{ .Title | .RenderString }}
                {{- if .Draft -}}
                  <sup>
                    <span class="entry-isdraft">
                      [{{- i18n "draft" | default "Draft" -}}]
                    </span>
                  </sup>
                {{- end -}}
                </h3>
              </a>
              <div class="archive-meta">
                {{ .Store.Set "archives" true }}
                {{- partial "meta.html" . -}}
              </div>
            </article>
            {{- end -}}
          </div>
        </div>
        {{- end -}}
      </div>
    {{- end -}}
  {{- end -}}

</section>

{{- end -}}
{{/* end main */}}
