{{- define "main" -}}

{{/* Debug only in non-production environments. */}}
{{- if not hugo.IsProduction -}}
  {{- partial "debug.html" . -}}
{{- end -}}

{{/* Get pages from current Section */}}
{{- $pages := .RegularPages -}}

{{/* Get pages from default language Site for this Term. */}}
{{- $defaultTerm := index (index site.Sites.Default.Taxonomies .Data.Plural) .Data.Term -}}

{{/* Merge current language Term pages and default language Site fallback. */}}
{{- $fallbackPages := slice -}}
{{- if $defaultTerm -}}
  {{- range $p := $defaultTerm.Pages -}}
    {{- if not (in $pages $p.Translations) -}}
      {{- $fallbackPages = $fallbackPages | append $p -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- $pages = sort (union $pages $fallbackPages) "Date" "desc" -}}
{{- $count := len $pages -}}

<header>
  {{- partial "categories_list.html" . -}}

  <h1 class="title">
    {{ .Data.Singular | title }}: {{ .Title | .RenderString }} ({{ $count }})
  </h1>

  {{- if .Description -}}
    <h3 class="description">
      {{ .Description | .RenderString }}
    </h3>
  {{- end -}}

  {{- with site.GetPage "news" -}}
    {{- partial "hero_cover.html" . -}}
  {{- end -}}
</header>

{{- partial "list_paginator.html" (dict "pages" $pages "context" .) -}}

{{- end -}}
{{/* End main. */}}
