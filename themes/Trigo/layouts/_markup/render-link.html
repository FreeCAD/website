{{- /* Custom rendering hook for content links:

  - Support relative, absolute, internal, external and fragment link destination path or url.
  - External links open in new tab and include icon.
  - Internal links show tooltip preview on hover.
  - Internal hash links include icon.

  @returns {template.HTML}

  @examples

    [Link description text](link/destination "Link title")

*/ -}}

{{- $url := urls.Parse .Destination -}}
{{- $href := $url.String -}}

{{- if strings.HasPrefix .Destination "#" -}}
  {{- $href = printf "%s#%s" .PageInner.RelPermalink $url.Fragment -}}
{{- else if and $href (not $url.IsAbs) -}}
  {{- $path := strings.TrimPrefix "./" $url.Path -}}
  {{- with or
    ($.PageInner.GetPage $path)
    ($.PageInner.Resources.Get $path)
    (resources.Get $path)
  -}}
    {{- $href = .RelPermalink -}}
    {{- with $url.RawQuery -}}
      {{- $href = printf "%s?%s" $href . -}}
    {{- end -}}
    {{- with $url.Fragment -}}
      {{- $href = printf "%s#%s" $href . -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- $base := strings.TrimSuffix "/" site.BaseURL -}}
{{- $isExternal := and
  (strings.HasPrefix $href "http")
  (not (strings.HasPrefix (strings.TrimSuffix "/" $href) $base))
-}}

{{- $title := .Title | plainify | default (i18n "link" | default "Open link") -}}
{{- $text := .Text -}}

{{- $classes := slice (cond $isExternal "external-link" "internal-tooltip") -}}
{{- if strings.HasPrefix $url "#" -}}
  {{- $classes = $classes | append "hash-link" -}}
{{- end -}}

<a href="{{ $href }}"
  class="{{ delimit $classes " " }}"
  {{- if $isExternal -}}
    title="{{ $title }}"
    target="_blank"
    rel="external noreferrer noopener"
  {{- end -}}>

  {{- if strings.HasPrefix $url "#" -}}
    {{- partial "utils/icon.html" "hash" -}}
  {{- end -}}

  {{- with $text -}}
    {{ . }}
  {{- end -}}

  {{- if $isExternal -}}
    {{- partial "utils/icon.html" "external" -}}
  {{- end -}}

  {{- if not $isExternal -}}
    {{- with .Page.GetPage .Destination -}}
      <span class="tooltip">
        <strong>{{- .Title -}}</strong>
        {{- .Description | default .Summary | .RenderString -}}
      </span>
    {{- end -}}
  {{- end -}}
</a>