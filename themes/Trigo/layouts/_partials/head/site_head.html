{{- /* HTML Head:

  - Set page meta and links.
  - Set analytics and theme toggle script.
*/ -}}

{{- $pageTitle := cond (and .Title (not .IsHome)) (printf "%s | %s" site.Title .Title) site.Title | plainify -}}
{{- $description := cond (or .IsPage .IsSection) (or .Description .Summary) (or site.Params.subtitle site.Params.description) | plainify -}}
{{- $keywords := .Keywords | default .Params.tags | default site.Params.keywords -}}
{{- if reflect.IsSlice $keywords -}}
  {{- $keywords = delimit $keywords ", " -}}
{{- end -}}
{{- $isProd := or hugo.IsProduction (eq site.Params.env "production") -}}

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta name="robots" content="{{ cond $isProd "index, follow" "noindex, nofollow" }}">

  <title>{{- $pageTitle -}}</title>
  <meta name="description" content="{{ $description }}">
  <meta name="keywords" content="{{ $keywords }}">
  <link rel="canonical" href="{{ .Permalink }}">

  {{- /* Favicons. */ -}}
  {{- if fileExists "static/favicon.svg" -}}
    <link rel="icon" type="image/svg+xml" href="{{ "favicon.svg" | relURL }}">
  {{- end -}}
  {{- if fileExists "static/favicon.ico" -}}
    <link rel="shortcut icon" type="image/x-icon" href="{{ "favicon.ico" | relURL }}">
  {{- end -}}
  {{- if fileExists "static/apple-touch-icon.png" -}}
    <link rel="apple-touch-icon" href="{{ "apple-touch-icon.png" | relURL }}">
  {{- end -}}

  {{- range .AllTranslations -}}
    <link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}">
  {{- end -}}
  <link rel="alternate" hreflang="x-default" href="{{ .Site.Home.Permalink }}">

  {{- /* Get chroma script to change between light and dark theme. */ -}}
  {{- partial "scripts/chroma.html" . -}}

  {{- /* Get stylesheets. */ -}}
  {{- partialCached "utils/styles.html" . -}}

  {{- if $isProd -}}
    {{- /* Get google analytics. */ -}}
    {{- if site.Config.Services.GoogleAnalytics.ID -}}
      {{- partial "google_analytics.html" . -}}
    {{- end -}}

    {{- /* Get open graph protocol metadata. */ -}}
    {{- partial "opengraph.html" . -}}
  {{- end -}}
</head>