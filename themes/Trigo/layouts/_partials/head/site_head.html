{{- /* HTML Head:

  - Set page meta and links.
  - Set analytics and theme toggle script.
*/ -}}

{{- $pageTitle := cond (and .Title (not .IsHome)) (printf "%s | %s" site.Title .Title) site.Title -}}
{{- $description := .Description | default (cond (or .IsPage .IsSection) .Summary site.Params.description) -}}
{{- $keywords := .Params.tags | default site.Params.keywords -}}
{{- if reflect.IsSlice $keywords -}}
  {{- $keywords = delimit $keywords ", " -}}
{{- end -}}
{{- $isProd := or hugo.IsProduction (eq site.Params.env "production") -}}

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta name="robots" content="{{ cond $isProd "index, follow" "noindex, nofollow" }}">

  <title>{{ $pageTitle | plainify }}</title>
  <meta name="description" content="{{ $description | default $pageTitle | plainify }}">
  <meta name="keywords" content="{{ $keywords | default $pageTitle }}">
  <link rel="canonical" href="{{ .Permalink }}">

  {{- partialCached "utils/styles.html" . -}}

  {{- /* Favicons. */ -}}
  <link rel="icon" href="{{ "favicon.ico" | absURL }}">
  <link rel="apple-touch-icon" href="{{ "apple-touch-icon.png" | absURL }}">

  {{- range .AllTranslations -}}
    <link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}">
  {{- end -}}

  {{- if $isProd -}}
    {{- /* Get google analytics. */ -}}
    {{- if site.Config.Services.GoogleAnalytics.ID -}}
      {{- partial "google_analytics.html" . -}}
    {{- end -}}

    {{- /* Get open graph protocol metadata. */ -}}
    {{- partial "opengraph.html" . -}}
  {{- end -}}
</head>

{{- /* Get chroma script to change between light and dark theme. */ -}}
{{- partial "scripts/chroma.html" . -}}