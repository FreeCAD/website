{{- /* Centralize JavaScript dependencies and custom scripts:

  - Defer load of JS after HTML is fully parsed and DOM elements available (also performance).
  - Set Chroma toggle listener.
  - Load User Agent script for download options.
  - Load Copy Code button and interaction script.
  - Load Open Details script.
  - Load Donate Box script.
*/ -}}

{{- /* Theme Chroma toggle. */ -}}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const button = document.getElementById("chroma-toggle");
    if (!button) return;

    button.addEventListener("click", () => {
      const dark = document.documentElement.classList.toggle("dark");
      localStorage.setItem("pref-theme", dark ? "dark" : "light");
    });
  });
</script>

{{- /* Detect User Agent and provide corresponding download options. */ -}}
{{- if and (in (slice "download" "releases") .Section) site.Params.enableJSua -}}
  {{- with resources.Get "js/ua-download.js" }}
    {{- $ua := . -}}
    {{- if hugo.IsProduction -}}
      {{- $ua = $ua | minify | fingerprint -}}
    {{- end -}}
    <script src="{{ $ua.RelPermalink }}"
      type="text/javascript"
      {{ if hugo.IsProduction }}integrity="{{ $ua.Data.Integrity }}" crossorigin="anonymous"{{ end }}
      defer>
    </script>
  {{- end -}}
{{- end -}}

{{- /* Copy Code block content to clipboard. */ -}}
{{- if and (eq .Kind "page") (ne .Layout "archives") site.Params.showCopyCodeButton -}}
  {{- with resources.Get "js/copy.js" -}}
    {{- $codeCopy := resources.ExecuteAsTemplate "js/code-copy.js" $ . -}}
    {{- if hugo.IsProduction -}}
      {{- $codeCopy = $codeCopy | minify | fingerprint -}}
    {{- end -}}
    <script src="{{ $codeCopy.RelPermalink }}"
      type="text/javascript"
      {{ if hugo.IsProduction }}integrity="{{ $codeCopy.Data.Integrity }}" crossorigin="anonymous"{{ end }}
      defer>
    </script>
  {{- end -}}
{{- end -}}

{{- /* Open Details block with anchor link. */ -}}
{{- if and (in .Content "<details") site.Params.enableJSdetails -}}
  {{- with resources.Get "js/open-details.js" -}}
    {{- $detailsToggle := . -}}
    {{- if hugo.IsProduction -}}
      {{- $detailsToggle = $detailsToggle | minify | fingerprint -}}
    {{- end -}}
    <script src="{{ $detailsToggle.RelPermalink }}"
      type="text/javascript"
      {{ if hugo.IsProduction }}integrity="{{ $detailsToggle.Data.Integrity }}" crossorigin="anonymous"{{ end }}
      defer>
    </script>
  {{- end -}}
{{- end -}}

{{- /* Validate and submit Donation Box form. */ -}}
{{- if and (eq .Section "donate") site.Params.enableJSdonate -}}
  {{- with resources.Get "js/donate.js" -}}
    {{- $donateBox := . -}}
    {{- if hugo.IsProduction -}}
      {{- $donateBox = $donateBox | minify | fingerprint -}}
    {{- end -}}
    <script src="{{ $donateBox.RelPermalink }}"
      type="text/javascript"
      {{ if hugo.IsProduction }}integrity="{{ $donateBox.Data.Integrity }}" crossorigin="anonymous"{{ end }}
      defer>
    </script>
  {{- end -}}
{{- end -}}

{{- /* Branch shortcode script. */ -}}
{{- if .HasShortcode "branch" -}}
  {{- with resources.Get "js/shortcode-branch.js" -}}
    {{- $branch := . -}}
    {{- if hugo.IsProduction -}}
      {{- $branch = $branch | minify | fingerprint -}}
    {{- end -}}
    <script src="{{ $branch.RelPermalink }}"
      type="text/javascript"
      {{ if hugo.IsProduction }}integrity="{{ $branch.Data.Integrity }}" crossorigin="anonymous"{{ end }}
      defer>
    </script>
  {{- end -}}
{{- end -}}


{{- /* Images carousel shortcode script. */ -}}
{{- if and (.HasShortcode "carousel") site.Params.enableJScarousel -}}
  {{- with resources.Get "js/carousel.js" -}}
    {{- $carousel := . -}}
    {{- if hugo.IsProduction -}}
      {{- $carousel = $carousel | minify | fingerprint -}}
    {{- end -}}
    <script src="{{ $carousel.RelPermalink }}"
      type="text/javascript"
      {{ if hugo.IsProduction }}integrity="{{ $carousel.Data.Integrity }}" crossorigin="anonymous"{{ end }}
      defer>
    </script>
  {{- end -}}
{{- end -}}


{{- /* Compare shortcode script. */ -}}
{{- if and (.HasShortcode "compare") site.Params.enableJScompare -}}
  {{- with resources.Get "js/compare.js" -}}
    {{- $compare := . -}}
    {{- if hugo.IsProduction -}}
      {{- $compare = $compare | minify | fingerprint -}}
    {{- end -}}
    <script src="{{ $compare.RelPermalink }}"
      type="text/javascript"
      {{ if hugo.IsProduction }}integrity="{{ $compare.Data.Integrity }}" crossorigin="anonymous"{{ end }}
      defer>
    </script>
  {{- end -}}
{{- end -}}
